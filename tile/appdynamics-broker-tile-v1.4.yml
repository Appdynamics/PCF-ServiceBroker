---
name: appdynamics-broker                                       # [1]
product_version: 1.4.0                            # [1]
label: AppDynamics Service Broker version 4.1.5.3 
rank: 50
metadata_version: '1.4'                                    # [2]
icon_image: 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

serial: true
releases:                                                  # [5]
- name: appdynamics_broker
  version: '4.1.5.3'
  file: appdynamics_broker-4.1.5.3.tgz

# EDIT the stemcell version as required
stemcell_criteria:                                                  # [3]
  os: ubuntu-trusty
  version: '2865.1'
  requires_cpi: false

property_blueprints:
- name: encryption_key
  type: secret
- name: vm_credentials
  type: salted_credentials
  default:
    identity: vcap
- name: app_name
  type: string
  configurable: true
  default: AppDynamicsServiceBroker
- name: app_version
  type: string
  configurable: true
  default: v1
- name: app_uri
  type: string
  configurable: true
  default: appdynamics-service-broker
- name: machine_agent_app_name
  type: string
  configurable: true
  default: AppDynamicsPCFOpsMetrics
- name: machine_agent_app_version
  type: string
  configurable: true
  default: v1
- name: machine_agent_app_uri
  type: string
  configurable: true
  default: appdynamics-machine-agent
- name: ops_metrics_host
  type: string
  configurable: true
- name: ops_metrics_port
  type: integer
  configurable: true
- name: ops_metrics_authenticate
  type: boolean
  configurable: true
- name: ops_metrics_jmx_user
  type: string
  configurable: true
- name: ops_metrics_jmx_password
  type: secret
  configurable: true
- name: account_name
  type: string
  configurable: true
- name: account_access_key
  type: string
  configurable: true
- name: controller_host
  type: string
  configurable: true
- name: controller_port
  type: integer
  configurable: true
- name: tier_name
  type: string
  configurable: true
  default: 'MachineAgentTier'
- name: node_name
  type: string
  configurable: true
  default: 'MachineAgentNode'
- name: ssl_enabled
  type: boolean
  configurable: true
  default: true
- name: internal_service_names
  type: string
  configurable: false
  default: "appdynamics"
- name: create_open_security_group
  type: boolean
  configurable: true
  default: false
- name: enable_global_access_to_plans
  type: boolean
  configurable: true
  default: false
- name: org_quota
  type: integer
  configurable: false
  constraints:
    min: 512
    max: 1024
  default: 512
- name: memory
  type: integer
  configurable: false
  constraints:
    min: 256
    max: 1024
  default: 256
# This for any internal plans prebuilt into the service broker that needs to be registered with CF
### ON_DEMAND_PLAN_BEGIN_MARKER
- name: on_demand_service_plans_collection
  type: collection
  configurable: true
  property_blueprints:
  - name: guid
    type: uuid
    optional: false
    unique: true
  - name: plan_name
    type: string
    configurable: true
  - name: plan_description
    type: string
    configurable: true
  - name: account_name
    type: string
    configurable: true
  - name: account_access_key
    type: string
    configurable: true
  - name: controller_host
    type: string
    configurable: true
  - name: controller_port
    type: integer
    configurable: true
  - name: ssl_enabled
    type: boolean
    configurable: true
    default: true
form_types:
- property_inputs:
  - reference: ".properties.app_name"
    label: Service Broker Application Name
    description: Enter the name for the Service Broker App
#  - reference: ".properties.app_version"
#    label: Service Broker Application Version
#    description: Enter the version of the Service Broker App (Final app name would
#      include app version like ${appName}-${appversion}
  - reference: ".properties.app_uri"
    label: Service Broker Application URI
    description: Enter the uri/endpoint for the Service Broker app (on push to CF)
  - reference: ".properties.create_open_security_group"
    label: Open up Security Groups
    description: Open up security group on CF for Service Broker to access other apps
      or CF Cloud Controller
  - reference: ".properties.enable_global_access_to_plans"
    label: Enable Access of Brokered Services and Plans to Everyone
    description: Open up All Services and plans to everyone across all orgs and spaces
  - reference: ".properties.on_demand_service_plans_collection"
    label: Service Plans
    property_inputs:
    - reference: plan_name
      label: Plan Name
      description: "Name of Plan"
      slug: false
    - reference: plan_description
      label: Plan Description
      description: "Description of Plan"
      slug: false
    - reference: account_name
      label: Account Name
      description: "Account Name"
      slug: false
    - reference: account_access_key
      label: Account Access Key
      description: "Account Access Key"
      slug: false
    - reference: controller_host
      label: AppDynamics Controller Host Address/IP
      description: "AppDynamics Controller FQDN Address/IP"
      slug: false
    - reference: controller_port
      label: AppDynamics Controller Port
      description: "AppDynamics Controller Port"
      slug: false
    - reference: ssl_enabled
      label: AppDynamics Controller SSL Enabled
      description: "Is AppDynamics Controller SSL Enabled"
      slug: false
  name: appdynamics_broker_app
  label: Service Broker Application
  description: Service Broker Configuration
- property_inputs:
  - reference: ".properties.machine_agent_app_name"
    label: Application Name
    description: Enter the name for the Machine Agent Extension for PCF OPS Metrics
#  - reference: ".properties.machine_agent_app_version"
#    label: Application Version
#    description: Enter the version of the Machine Agent App (Final app name would
#      include app version like ${appName}-${appversion}
  - reference: ".properties.machine_agent_app_uri"
    label: Application URI
    description: Enter the uri/endpoint for the Machine Agent app (on push to CF)
  - reference: ".properties.create_open_security_group"
    label: Open up Security Groups
    description: Open up security group on CF for Service Broker to access other apps
      or CF Cloud Controller
  - reference: .properties.account_name
    label: Account Name
    description: "Account Name"
  - reference: .properties.account_access_key
    label: Account Access Key
    description: "Account Access Key"
  - reference: .properties.controller_host
    label: AppDynamics Controller Host Address/IP
    description: "AppDynamics Controller Host Address/IP"
  - reference: .properties.controller_port
    label: AppDynamics Controller Port
    description: "AppDynamics Controller Port"
  - reference: .properties.ssl_enabled
    label: AppDynamics Controller SSL Enabled
    description: "Is AppDynamics Controller SSL Enabled"
  - reference: .properties.ops_metrics_host
    label: Ops Metrics Host Address
    description: "PCF Ops Metrics Host Address"
  - reference: .properties.ops_metrics_port
    label: Ops Metrics Host Port
    description: "PCF Ops Metrics Host Port"
  - reference: .properties.ops_metrics_authenticate
    label: Ops Metrics JMX Authenticate
    description: "PCF Ops Metrics JMX login with Authentication"
  - reference: .properties.ops_metrics_jmx_user
    label: Ops Metrics JMX User Id
    description: "PCF Ops Metrics JMX User Id"
  - reference: .properties.ops_metrics_jmx_password
    label: Ops Metrics JMX User Password
    description: "PCF Ops Metrics JMX User Password"
  name: appdynamics_machine_agent_app
  label: Machine Agent Extension for PCF OPS Metrics
  description: Machine Agent Configuration
job_types:
- name: deploy-service-broker
  resource_label: Deploy AppDynamics Service Broker
  release: appdynamics_broker
  errand: true
  job_templates:
  - deploy-service-broker
  resource_definitions:
  - name: ram
    type: integer
    configurable: false
    default: 512
  - name: ephemeral_disk
    type: integer
    configurable: false
    default: 2048
  - name: persistent_disk
    type: integer
    configurable: false
    default: 0
  - name: cpu
    type: integer
    configurable: false
    default: 1
  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1
  instance_definitions:
  - name: instances
    type: integer
    configurable: false
    default: 1
  property_blueprints:
  - name: vm_credentials
    type: salted_credentials
    default:
      identity: vcap
  - name: broker_credentials
    type: salted_credentials

  manifest: |
    domain: (( ..cf.cloud_controller.system_domain.value ))
    app_domains:
      - (( ..cf.cloud_controller.apps_domain.value ))
    ssl:
      skip_cert_verify: (( ..cf.ha_proxy.skip_cert_verify.value ))
    uaa:
      url: https://uaa.(( ..cf.cloud_controller.system_domain.value ))
      clients:
        appdynamics_broker:
          secret: test
    appdynamics_broker:
      app_name: (( .properties.app_name.value ))
      app_version: (( .properties.app_version.value ))
      app_uri: (( .properties.app_uri.value ))
      create_open_security_group: (( .properties.create_open_security_group.value ))
      app_push:
        org_quota: (( .properties.org_quota.value ))
        timeout: 180
        memory: (( .properties.memory.value ))
      persistence_store_type: none
      on_demand_service_plans: (( .properties.on_demand_service_plans_collection.value ))
      encryption_key: (( .properties.encryption_key.value ))
      cf:
        admin_user: (( ..cf.uaa.system_services_credentials.identity ))
        admin_password: (( ..cf.uaa.system_services_credentials.password ))
      broker:
        user: (( .deploy-service-broker.broker_credentials.identity ))
        password: (( .deploy-service-broker.broker_credentials.password ))
        internal_service_names: (( .properties.internal_service_names.value ))

- name: deploy-machine-agent
  resource_label: Deploy AppDynamics Machine Agent
  release: appdynamics_broker
  errand: true
  job_templates:
  - deploy-machine-agent
  resource_definitions:
  - name: ram
    type: integer
    configurable: false
    default: 1024
  - name: ephemeral_disk
    type: integer
    configurable: false
    default: 2048
  - name: persistent_disk
    type: integer
    configurable: false
    default: 0
  - name: cpu
    type: integer
    configurable: false
    default: 1
  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1
  instance_definitions:
  - name: instances
    type: integer
    configurable: false
    default: 1
  property_blueprints:
  - name: vm_credentials
    type: salted_credentials
    default:
      identity: vcap
  - name: broker_credentials
    type: salted_credentials

  manifest: |
    domain: (( ..cf.cloud_controller.system_domain.value ))
    app_domains:
      - (( ..cf.cloud_controller.apps_domain.value ))
    ssl:
      skip_cert_verify: (( ..cf.ha_proxy.skip_cert_verify.value ))
    uaa:
      url: https://uaa.(( ..cf.cloud_controller.system_domain.value ))
      clients:
        appdynamics_broker:
          secret: test
    appdynamics_machine_agent:
      app_name: (( .properties.machine_agent_app_name.value ))
      app_version: (( .properties.machine_agent_app_version.value ))
      app_uri: (( .properties.machine_agent_app_uri.value ))
      app_push:
        org_quota: (( .properties.org_quota.value ))
        timeout: 180
        memory: (( .properties.memory.value ))
      encryption_key: (( .properties.encryption_key.value ))
      create_open_security_group: (( .properties.create_open_security_group.value ))
      account_name: (( .properties.account_name.value ))
      account_access_key: (( .properties.account_access_key.value ))
      controller_host: (( .properties.controller_host.value ))
      controller_port: (( .properties.controller_port.value ))
      ssl_enabled: (( .properties.ssl_enabled.value ))
      tier_name: (( .properties.tier_name.value ))
      node_name: (( .properties.node_name.value ))
      ops_metrics_host: (( .properties.ops_metrics_host.value ))
      ops_metrics_port: (( .properties.ops_metrics_port.value ))
      ops_metrics_authenticate: (( .properties.ops_metrics_authenticate.value ))
      ops_metrics_jmx_user: (( .properties.ops_metrics_jmx_user.value ))
      ops_metrics_jmx_password: (( .properties.ops_metrics_jmx_password.value ))
      cf:
        admin_user: (( ..cf.uaa.system_services_credentials.identity ))
        admin_password: (( ..cf.uaa.system_services_credentials.password ))
      broker:
        user: (( .deploy-machine-agent.broker_credentials.identity ))
        password: (( .deploy-machine-agent.broker_credentials.password ))

- name: register-broker
  release: appdynamics_broker
  resource_label: Register AppDynamics Service Broker
  job_templates:
  - register-broker
  errand: true
  resource_definitions:
  - name: ram
    type: integer
    configurable: false
    default: 1024
  - name: ephemeral_disk
    type: integer
    configurable: false
    default: 2048
  - name: persistent_disk
    type: integer
    configurable: false
    default: 0
  - name: cpu
    type: integer
    configurable: false
    default: 1
  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1
  instance_definitions:
  - name: instances
    type: integer
    configurable: false
    default: 1
  property_blueprints:
  - name: vm_credentials
    type: salted_credentials
    default:
      identity: vcap

  manifest: |
    domain: (( ..cf.cloud_controller.system_domain.value ))
    app_domains:
      - (( ..cf.cloud_controller.apps_domain.value ))
    ssl:
      skip_cert_verify: (( ..cf.ha_proxy.skip_cert_verify.value ))
    uaa:
      url: https://uaa.(( ..cf.cloud_controller.system_domain.value ))
      clients:
        appdynamics_broker:
          secret: test
    appdynamics_broker:
      app_name: (( .properties.app_name.value ))
      app_version: (( .properties.app_version.value ))
      app_uri: (( .properties.app_uri.value ))
      encryption_key: (( .properties.encryption_key.value ))
      enable_global_access_to_plans: (( .properties.enable_global_access_to_plans.value ))
      cf:
        admin_user: (( ..cf.uaa.system_services_credentials.identity ))
        admin_password: (( ..cf.uaa.system_services_credentials.password ))
      broker:
        user: (( .deploy-service-broker.broker_credentials.identity ))
        password: (( .deploy-service-broker.broker_credentials.password ))
        internal_service_names: (( .properties.internal_service_names.value ))

- name: destroy-broker
  release: appdynamics_broker
  resource_label: Remove AppDynamics Service Broker
  job_templates:
  - destroy-broker
  errand: true
  resource_definitions:
  - name: ram
    type: integer
    configurable: false
    default: 1024
  - name: ephemeral_disk
    type: integer
    configurable: false
    default: 1024
  - name: persistent_disk
    type: integer
    configurable: false
    default: 0
  - name: cpu
    type: integer
    configurable: false
    default: 1
  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1
  instance_definitions:
  - name: instances
    type: integer
    configurable: false
    default: 1
  property_blueprints:
  - name: vm_credentials
    type: salted_credentials
    default:
      identity: vcap

  manifest: |
    domain: (( ..cf.cloud_controller.system_domain.value ))
    app_domains:
      - (( ..cf.cloud_controller.apps_domain.value ))
    ssl:
      skip_cert_verify: (( ..cf.ha_proxy.skip_cert_verify.value ))
    uaa:
      url: https://uaa.(( ..cf.cloud_controller.system_domain.value ))
      clients:
        appdynamics_broker:
          secret: test
    appdynamics_broker:
      app_name: (( .properties.app_name.value ))
      app_version: (( .properties.app_version.value ))
      app_uri: (( .properties.app_uri.value ))
      encryption_key: (( .properties.encryption_key.value ))
      cf:
        admin_user: (( ..cf.uaa.system_services_credentials.identity ))
        admin_password: (( ..cf.uaa.system_services_credentials.password ))
      broker:
        user: (( .deploy-service-broker.broker_credentials.identity ))
        password: (( .deploy-service-broker.broker_credentials.password ))
        internal_service_names: (( .properties.internal_service_names.value ))

- name: destroy-machine-agent
  release: appdynamics_broker
  resource_label: Remove AppDynamics Machine Agent
  job_templates:
  - destroy-machine-agent
  errand: true
  resource_definitions:
  - name: ram
    type: integer
    configurable: false
    default: 1024
  - name: ephemeral_disk
    type: integer
    configurable: false
    default: 1024
  - name: persistent_disk
    type: integer
    configurable: false
    default: 0
  - name: cpu
    type: integer
    configurable: false
    default: 1
  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1
  instance_definitions:
  - name: instances
    type: integer
    configurable: false
    default: 1
  property_blueprints:
  - name: vm_credentials
    type: salted_credentials
    default:
      identity: vcap

  manifest: |
    domain: (( ..cf.cloud_controller.system_domain.value ))
    app_domains:
      - (( ..cf.cloud_controller.apps_domain.value ))
    ssl:
      skip_cert_verify: (( ..cf.ha_proxy.skip_cert_verify.value ))
    uaa:
      url: https://uaa.(( ..cf.cloud_controller.system_domain.value ))
      clients:
        appdynamics_broker:
          secret: test
    appdynamics_machine_agent:
      app_name: (( .properties.machine_agent_app_name.value ))
      app_version: (( .properties.machine_agent_app_version.value ))
      app_uri: (( .properties.machine_agent_app_uri.value ))
      encryption_key: (( .properties.encryption_key.value ))
      cf:
        admin_user: (( ..cf.uaa.system_services_credentials.identity ))
        admin_password: (( ..cf.uaa.system_services_credentials.password ))
      broker:
        user: (( .deploy-machine-agent.broker_credentials.identity ))
        password: (( .deploy-machine-agent.broker_credentials.password ))

- name: compilation
  resource_label: compilation
  resource_definitions:
   - name: ram
     type: integer
     configurable: true
     default: 1024
   - name: ephemeral_disk
     type: integer
     configurable: true
     default: 1024
   - name: persistent_disk
     type: integer
     configurable: true
     default: 0
   - name: cpu
     type: integer
     configurable: true
     default: 2

  static_ip: 0
  dynamic_ip: 1
  max_in_flight: 1

  instance_definitions:
    - name: instances
      type: integer
      default: 1

update:
  canaries: 1
  canary_watch_time: 60000-240000
  max_in_flight: 1
  update_watch_time: 60000-240000

requires_product_versions:
- name: cf
  version: "~> 1.3"
provides_product_versions:
- name: appdynamics_broker
  version: '4.1.5.3'
post_deploy_errands:
- name: deploy-service-broker
- name: deploy-machine-agent
- name: register-broker
pre_delete_errands:
- name: destroy-broker
- name: destroy-machine-agent


